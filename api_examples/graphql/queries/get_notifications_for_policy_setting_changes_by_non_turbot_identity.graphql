# Description
# -----------
#
#
# The query returns the data from activity log.
# Filters out the resources that have policy setting changes created,updated or deleted by a non-turbot identity within last 24 hours.
# 
#

# Usage
# -----
#
# turbot graphql --query ./get_notifications_for_policy_setting_changes_by_non_turbot_identity.graphql
#

# Filter
# ------
#
# notificationType:
#   Filter on the general type of notifications.
#   This will filter all create, update, and delete notifications of a given class. 
#   In example, this is set to `notificationType:policy_setting_created,policy_setting_updated,policy_setting_deleted`.
#
# actorIdentityId:
#   The ID of the profile who last updated or created the resource.
#   In example, the profile id is for punisher i.e. '173249891011852'.
#   In example, the data are filtered that are deleted by non turbot identity i.e. 'actorIdentityId:-173249891011852'.
#
# sort:
#   Sets the order of the returned query results.
#   In this example, it is set to `sort:-timestamp`.
#
# timestamp:
#   The time when resource was last created or updated.
#   In this example, it is set for last 24 hours.
#
# limit:
#   The number of data filtered out.
#   In this example, it is set to 10.

# Documentation
# -------------
#
# For full documentation see:
# - Filter documentation: https://turbot.com/v5/docs/reference/filter
# - GraphQL notifications: https://turbot.com/v5/docs/reference/filter/notifications
# - GraphQL notifications type: https://turbot.com/v5/docs/concepts/notifications#notification-types
#

query GetNotificationsForPolicySettingChangesByNonTurbotIdentity {
  notifications(filter: "notificationType:policy_setting_created,policy_setting_updated,policy_setting_deleted timestamp:>T-1d sort:-timestamp actorIdentityId:-173249891011852 limit:10") {
    metadata {
      stats {
        total
      }
    }
    items {
      notificationType
      actor {
        identity {
          title
        }
      }
      resource {
        turbot {
          title
          createTimestamp
          actorIdentityId
          akas
        }
      }
      policySetting {
        actor {
          identity {
            title
          }
        }
        value
      }
    }
  }
}
