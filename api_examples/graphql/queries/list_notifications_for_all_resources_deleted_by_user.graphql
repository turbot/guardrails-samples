# Description
# -----------
#
# Query will return "resource that were delete" for the last day triggered by a particular user provided the user exists.
#

# Substitute
# ----------
#
# Substitute real values for the token <actor_indentity_id>.
#
# <actor_indentity_id>:
#   Any valid actor identity id can be substituted.
#   To get actor identity id for a user, please see GraphQL example:
#     `get_user_actor_identity_id.graphql`.
#   To get the actor identity id for Turbot identity, please see GraphQL example:
#     `get_turbot_actor_identity_id.graphql.graphql`.
#

# Execute
# -------
#
# To execute the query after substitution, run the Turbot CLI command:
#   `turbot graphql --query ./list_notifications_for_all_resources_deleted_by_user.graphql`
#

# Use Cases
# ---------
#
#   Include the user Turbot Identity
#   ----------------------------------
#     1. Get the actor identity id for Turbot identity by running GraphQL example: `get_turbot_actor_identity_id.graphql`.
#     2. Replace `<actor_indentity_id>` with this value.
#     3. Excute this GraphQL script
#
#   Include a particular user
#   ---------------------------
#     1. Get the actor identity id for Turbot identity by running GraphQL example: `get_user_actor_identity_id.graphql`.
#     2. Replace `<actor_indentity_id>` with this value.
#     3. Excute this GraphQL script
#

# Documentation
# -------------
#
# For full documentation see:
#   - Filter documentation: https://turbot.com/v5/docs/reference/filter
#   - GraphQL notifications: https://turbot.com/v5/docs/reference/filter/notifications
#   - GraphQL notifications type: https://turbot.com/v5/docs/concepts/notifications#notification-types
#

################# OLD

# Description
# -----------
#
#
# The query returns the data from activity log.
# Filters out the resources that are deleted by a non-turbot identity within last 24 hours.
#
#

# Usage
# -----
#
# turbot graphql --query ./list_notifications_for_resource_deleted_by_actor_identity_id.graphql
#

# Filter
# ------
#
# notificationType:
#   Filter on the general type of notifications.
#   This will filter all create, update, and delete notifications of a given class.
#   In example, this is set to `notificationType:resource_deleted`.
#   The same example can be modified to filter resources,actions,policy values and many more that are either created , updated or deleted during any specific time.
#   The link for all notificationTypes that are supported by turbot is provided in Documentation below.
#
# actorIdentityId:
#   The ID of the profile who last updated or created the resource.
#   In example, the profile id is for punisher i.e. '173249891011852'.
#   In example, the data are filtered that are deleted by non turbot identity i.e. 'actorIdentityId:-173249891011852'.
#   The 'actorIdentityId:-173249891011852' signifies any actor other than turbot. The '-' is used to negated a filter condition.
#
# timestamp:
#   The time when resource was last created or updated.
#   In this example, it is set for last 24 hours.
#

# Documentation
# -------------
#
# For full documentation see:
# - Filter documentation: https://turbot.com/v5/docs/reference/filter
# - GraphQL notifications: https://turbot.com/v5/docs/reference/filter/notifications
# - GraphQL notifications type: https://turbot.com/v5/docs/concepts/notifications#notification-types
#

query ListNotificationsForAllResourcesDeletedByUser {
  notifications(filter: "actorIdentityId:<actor_indentity_id> notificationType:resource_deleted timestamp:>T-1d") {
    items {
      notificationType
      actor {
        identity {
          title
        }
      }
      resource {
        turbot {
          title
          createTimestamp
          deleteTimestamp
          updateTimestamp
          actorIdentityId
          akas
        }
      }
    }

    metadata {
      stats {
        total
      }
    }
  }
}
